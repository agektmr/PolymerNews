<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-toast/paper-toast.html">

<dom-module id="news-login">

  <style>
    .hide {
      display: none;
    }

     :host {
      --paper-card: {
        font-size: 12px;
        background-color: transparent;
      }
    }
  </style>

  <template>
    <paper-icon-button id="login" icon="account-circle" on-click="_login">
    </paper-icon-button>
    <paper-card id="card" class="hide" image="[[user.profilePicture]]">
      <div class="card-content">
        [[user.id]]
      </div>
    </paper-card>
    <paper-toast id="message">
    </paper-toast>
  </template>

  <script src="smartlock.js"></script>

  <script>
    var HINT_CONFIG = {
      supportedAuthMethods: [
        'smartlock://email',
        'https://accounts.google.com'
      ],
      supportedIdTokenProviders: [{
        uri: 'https://accounts.google.com',
        clientId: '511828570984-dhnshqcpegee66hgnp754dupe8sbas18.apps.googleusercontent.com'
      }]
    };

    openyolo.setProviderUrlBase('https://smartlock.sandbox.google.com/iframe/request');

    // register custom element.
    Polymer({
      is: 'news-login',
      properties: {
        user: {
          type: Object,
          notify: true
        },
      },
      _login: function () {
        var that = this;
        smartlock.hint(HINT_CONFIG)
          .then(function (credential) {
            that.set('user', credential);
            // toggle state
            that.$.login.classList.add('hide');
            that.$.card.classList.remove('hide');
            that.updateStyles();
            // broadcast event
            var newsApp = document.querySelector('news-app');
            if (newsApp) {
              newsApp._updateLoggedInState(credential);
              that.$.message.text = 'Welcome ' + credential.displayName;
              that.$.message.open();
            }
          });
      },
    });
  </script>

</dom-module>